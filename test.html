<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Cases | Exam Registration</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
    .pass { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .fail { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .pending { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
  </style>
</head>
<body>

<div class="container mt-5">
  <h2 class="mb-4">Exam Registration System - Test Cases</h2>
  
  <div class="row">
    <div class="col-md-6">
      <h4>Frontend Tests</h4>
      <button class="btn btn-primary mb-2" onclick="runFrontendTests()">Run Frontend Tests</button>
      <div id="frontendResults"></div>
    </div>
    
    <div class="col-md-6">
      <h4>Backend Tests</h4>
      <button class="btn btn-success mb-2" onclick="runBackendTests()">Run Backend Tests</button>
      <div id="backendResults"></div>
    </div>
  </div>

  <hr class="my-4">

  <div class="row">
    <div class="col-md-12">
      <h4>Integration Tests</h4>
      <button class="btn btn-warning mb-2" onclick="runIntegrationTests()">Run Integration Tests</button>
      <div id="integrationResults"></div>
    </div>
  </div>
</div>

<script>
// Frontend Test Cases
async function runFrontendTests() {
  const results = document.getElementById('frontendResults');
  results.innerHTML = '';
  const tests = [];

  // Test 1: Password visibility toggle
  tests.push({
    name: 'T1: Password Visibility Toggle',
    test: () => {
      const input = document.createElement('input');
      input.type = 'password';
      input.id = 'testPassword';
      document.body.appendChild(input);
      
      if (input.type === 'password') {
        input.type = 'text';
        const pass = input.type === 'text';
        document.body.removeChild(input);
        return pass;
      }
    }
  });

  // Test 2: LocalStorage functionality
  tests.push({
    name: 'T2: LocalStorage Save/Retrieve',
    test: () => {
      const testData = { name: 'John', rollNumber: '123' };
      localStorage.setItem('testUser', JSON.stringify(testData));
      const retrieved = JSON.parse(localStorage.getItem('testUser'));
      localStorage.removeItem('testUser');
      return retrieved.name === 'John' && retrieved.rollNumber === '123';
    }
  });

  // Test 3: Form validation - Empty fields
  tests.push({
    name: 'T3: Form Validation - Empty Roll Number',
    test: () => {
      const input = document.createElement('input');
      input.required = true;
      return input.required === true;
    }
  });

  // Test 4: Email validation format
  tests.push({
    name: 'T4: Email Validation Format',
    test: () => {
      const email = 'test@example.com';
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }
  });

  // Test 5: Phone number validation (10 digits)
  tests.push({
    name: 'T5: Phone Number Validation',
    test: () => {
      const phone = '9876543210';
      const phoneRegex = /^[0-9]{10}$/;
      return phoneRegex.test(phone);
    }
  });

  // Run all tests
  for (let test of tests) {
    try {
      const result = test.test();
      const status = result ? 'pass' : 'fail';
      results.innerHTML += `<div class="test-result ${status}"><strong>${test.name}</strong>: ${status.toUpperCase()}</div>`;
    } catch (error) {
      results.innerHTML += `<div class="test-result fail"><strong>${test.name}</strong>: FAIL - ${error.message}</div>`;
    }
  }
}

// Backend Test Cases
async function runBackendTests() {
  const results = document.getElementById('backendResults');
  results.innerHTML = '';
  const tests = [];

  // Test 1: Check if backend is running
  tests.push({
    name: 'T6: Backend Server Connection',
    test: async () => {
      try {
        const response = await fetch('http://localhost:5000/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ rollNumber: '', password: '' })
        });
        return response.status !== undefined;
      } catch (e) {
        throw new Error('Backend not running');
      }
    }
  });

  // Test 2: Invalid login credentials
  tests.push({
    name: 'T7: Invalid Login Credentials',
    test: async () => {
      const response = await fetch('http://localhost:5000/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ rollNumber: 'invalid', password: 'wrong' })
      });
      const data = await response.json();
      return response.status === 400;
    }
  });

  // Test 3: Missing required fields
  tests.push({
    name: 'T8: Missing Required Fields in Signup',
    test: async () => {
      const response = await fetch('http://localhost:5000/api/auth/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: 'John' }) // Missing other fields
      });
      return response.status === 400;
    }
  });

  // Test 4: Duplicate email check
  tests.push({
    name: 'T9: Duplicate Email Prevention',
    test: async () => {
      const userData = {
        name: 'Test User',
        rollNumber: 'TEST123',
        phone: '9876543210',
        email: 'test@test.com',
        password: 'password123'
      };

      const response = await fetch('http://localhost:5000/api/auth/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userData)
      });
      return response.status === 201 || response.status === 400;
    }
  });

  // Test 5: Exam registration endpoint
  tests.push({
    name: 'T10: Exam Registration Endpoint',
    test: async () => {
      const response = await fetch('http://localhost:5000/api/exams/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: '123', subject: 'Math' })
      });
      return response.status !== 404;
    }
  });

  // Run all tests
  for (let test of tests) {
    try {
      const result = await test.test();
      const status = result ? 'pass' : 'fail';
      results.innerHTML += `<div class="test-result ${status}"><strong>${test.name}</strong>: ${status.toUpperCase()}</div>`;
    } catch (error) {
      results.innerHTML += `<div class="test-result fail"><strong>${test.name}</strong>: FAIL - ${error.message}</div>`;
    }
  }
}

// Integration Test Cases
async function runIntegrationTests() {
  const results = document.getElementById('integrationResults');
  results.innerHTML = '';
  
  results.innerHTML += `<div class="test-result pending"><strong>I1: Complete Registration Flow</strong>: PENDING - Manual test required</div>`;
  results.innerHTML += `<div class="test-result pending"><strong>I2: Login and Exam Selection</strong>: PENDING - Manual test required</div>`;
  results.innerHTML += `<div class="test-result pending"><strong>I3: Payment Processing</strong>: PENDING - Manual test required</div>`;
  results.innerHTML += `<div class="test-result pending"><strong>I4: Data Persistence in MongoDB</strong>: PENDING - Manual test required</div>`;
  
  results.innerHTML += `
    <div class="alert alert-info mt-3">
      <h5>Manual Integration Tests:</h5>
      <ol>
        <li>Sign up with new credentials</li>
        <li>Login with roll number</li>
        <li>Select an exam subject</li>
        <li>Complete payment with transaction ID</li>
        <li>Verify data in MongoDB</li>
      </ol>
    </div>
  `;
}
</script>

</body>
</html>